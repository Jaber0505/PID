{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<h2>{{ title }}</h2>

<style>
  .admin-section {
    border: 1px solid #ddd;
    margin-bottom: 1rem;
    border-radius: 5px;
    overflow: hidden;
  }

  .admin-section summary {
    background: #f5f5f5;
    padding: 10px 15px;
    cursor: pointer;
    font-weight: bold;
  }

  .admin-section details[open] summary {
    background-color: #e9e9e9;
  }

  .admin-section table {
    width: 100%;
    border-collapse: collapse;
  }

  .admin-section th, .admin-section td {
    padding: 8px 12px;
    border: 1px solid #ccc;
    text-align: left;
  }

  .btn-danger {
    background-color: #dc3545;
    color: white;
    padding: 4px 10px;
    text-decoration: none;
    border-radius: 3px;
  }

  .btn-danger:hover {
    background-color: #b02a37;
  }

  .btn-primary {
    background-color: #007bff;
    color: white;
    padding: 4px 10px;
    border-radius: 3px;
    border: none;
  }

  .btn-primary:hover {
    background-color: #0056b3;
  }

  form.inline {
    display: inline;
  }

  input, select {
    margin-right: 8px;
  }
</style>

<!-- Utilisateurs -->
<details class="admin-section" open>
  <summary>üë• Utilisateurs ({{ users|length }})</summary>
  <table>
    <tr>
      <th>Nom</th>
      <th>Email</th>
      <th>R√¥le</th>
      <th>Actions</th>
    </tr>
    {% for user in users %}
      <tr>
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>
          <form method="post" action="{% url 'catalogue:admin-assign-role' %}" class="inline">
            {% csrf_token %}
            <input type="hidden" name="user_id" value="{{ user.id }}">
            <select name="role_id">
              <option value="">Aucun</option>
              {% for role in roles %}
                <option value="{{ role.id }}" {% if user.roleuser.role.id == role.id %}selected{% endif %}>{{ role.name }}</option>
              {% endfor %}
            </select>
            <button class="btn-primary" type="submit">‚úî</button>
          </form>
        </td>
        <td>
          {% if not user.is_superuser %}
          <form method="post" action="{% url 'catalogue:admin-delete-user' user.id %}" class="inline">
            {% csrf_token %}
            <button class="btn-danger" type="submit">Supprimer</button>
          </form>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="4">Aucun utilisateur.</td></tr>
    {% endfor %}
  </table>
</details>

<!-- Avis -->
<details class="admin-section">
  <summary>üìù Avis ({{ reviews|length }})</summary>
  <table>
    <tr>
      <th>Utilisateur</th>
      <th>Spectacle</th>
      <th>Note</th>
      <th>Commentaire</th>
      <th>Actions</th>
    </tr>
    {% for review in reviews %}
      <tr>
        <td>{{ review.user.username }}</td>
        <td>{{ review.show.title }}</td>
        <td>{{ review.rating }}/5</td>
        <td>{{ review.comment|truncatewords:10 }}</td>
        <td>
          <form method="post" action="{% url 'catalogue:admin-delete-review' review.id %}" class="inline">
            {% csrf_token %}
            <button class="btn-danger" type="submit">Supprimer</button>
          </form>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="5">Aucun avis.</td></tr>
    {% endfor %}
  </table>
</details>

<!-- Cr√©ation de r√¥les -->
<details class="admin-section">
  <summary>‚ûï G√©rer les r√¥les</summary>
  <form method="post" action="{% url 'catalogue:admin-create-role' %}" style="padding: 15px;">
    {% csrf_token %}
    <label for="name">Nom du r√¥le :</label>
    <input type="text" name="name" id="name" required>
    <button class="btn-primary" type="submit">Cr√©er</button>
  </form>
  <table>
    <tr>
      <th>R√¥le</th>
      <th>Actions</th>
    </tr>
    {% for role in roles %}
    <tr>
      <td>{{ role.name }}</td>
      <td>
        <form method="post" action="{% url 'catalogue:admin-delete-role' role.id %}" class="inline">
          {% csrf_token %}
          <button class="btn-danger" type="submit">Supprimer</button>
        </form>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="2">Aucun r√¥le d√©fini.</td></tr>
    {% endfor %}
  </table>
</details>

{% endblock %}
